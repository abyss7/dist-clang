# Used cmake args:
# -DLIBCXX_INCLUDE_BENCHMARKS=OFF
# -DLIBCXX_INCLUDE_TESTS=OFF
# -DLIBCXX_INCLUDE_DOCS=OFF

config("includes") {
  include_dirs = [ "exported/include" ]
}

config("flags") {
  cflags = [
    "-O3",
    "-pedantic",
    "-Wall",
    "-Wno-unused-parameter",
    "-Wwrite-strings",
    "-Wno-long-long",
    "-Wno-error",
  ]
  if (host_os == "win") {
    cflags += [ "-fno-ms-compatibility" ]
  }

  defines = [ "LIBCXX_BUILDING_LIBCXXABI", "_LIBCPP_BUILDING_LIBRARY" ]
  if (host_os == "win") {
    defines += [ "_HAS_CHAR16_T_LANGUAGE_SUPPORT" ]
  }

  if (host_os == "mac") {
    ldflags = [
      "-compatibility_version",
      "1.0.0",
      "-current_version",
      "1.0.0",
    ]
  }
}

shared_library("c++") {
  visibility = []
  visibility = [
    "//:*",
    "//src/*",
    "//tools/*",
  ]

  sources = [
    "exported/include/__bit_reference",
    "exported/include/__bsd_locale_defaults.h",
    "exported/include/__bsd_locale_fallbacks.h",
    "exported/include/__config",
    "exported/include/__debug",
    "exported/include/__functional_03",
    "exported/include/__functional_base",
    "exported/include/__functional_base_03",
    "exported/include/__hash_table",
    "exported/include/__libcpp_version",
    "exported/include/__locale",
    "exported/include/__mutex_base",
    "exported/include/__nullptr",
    "exported/include/__refstring",
    "exported/include/__split_buffer",
    "exported/include/__sso_allocator",
    "exported/include/__std_stream",
    "exported/include/__string",
    "exported/include/__threading_support",
    "exported/include/__tree",
    "exported/include/__tuple",
    "exported/include/__undef_macros",
    "exported/include/algorithm",
    "exported/include/any",
    "exported/include/array",
    "exported/include/atomic",
    "exported/include/bitset",
    "exported/include/cassert",
    "exported/include/ccomplex",
    "exported/include/cctype",
    "exported/include/cerrno",
    "exported/include/cfenv",
    "exported/include/cfloat",
    "exported/include/chrono",
    "exported/include/cinttypes",
    "exported/include/ciso646",
    "exported/include/climits",
    "exported/include/clocale",
    "exported/include/cmath",
    "exported/include/codecvt",
    "exported/include/complex",
    "exported/include/complex.h",
    "exported/include/condition_variable",
    "exported/include/csetjmp",
    "exported/include/csignal",
    "exported/include/cstdarg",
    "exported/include/cstdbool",
    "exported/include/cstddef",
    "exported/include/cstdint",
    "exported/include/cstdio",
    "exported/include/cstdlib",
    "exported/include/cstring",
    "exported/include/ctgmath",
    "exported/include/ctime",
    "exported/include/ctype.h",
    "exported/include/cwchar",
    "exported/include/cwctype",
    "exported/include/deque",
    "exported/include/errno.h",
    "exported/include/exception",
    "exported/include/experimental/__config",
    "exported/include/experimental/__memory",
    "exported/include/experimental/algorithm",
    "exported/include/experimental/any",
    "exported/include/experimental/chrono",
    "exported/include/experimental/coroutine",
    "exported/include/experimental/deque",
    "exported/include/experimental/dynarray",
    "exported/include/experimental/filesystem",
    "exported/include/experimental/forward_list",
    "exported/include/experimental/functional",
    "exported/include/experimental/iterator",
    "exported/include/experimental/list",
    "exported/include/experimental/map",
    "exported/include/experimental/memory_resource",
    "exported/include/experimental/numeric",
    "exported/include/experimental/optional",
    "exported/include/experimental/propagate_const",
    "exported/include/experimental/ratio",
    "exported/include/experimental/regex",
    "exported/include/experimental/set",
    "exported/include/experimental/string",
    "exported/include/experimental/string_view",
    "exported/include/experimental/system_error",
    "exported/include/experimental/tuple",
    "exported/include/experimental/type_traits",
    "exported/include/experimental/unordered_map",
    "exported/include/experimental/unordered_set",
    "exported/include/experimental/utility",
    "exported/include/experimental/vector",
    "exported/include/ext/__hash",
    "exported/include/ext/hash_map",
    "exported/include/ext/hash_set",
    "exported/include/float.h",
    "exported/include/forward_list",
    "exported/include/fstream",
    "exported/include/functional",
    "exported/include/future",
    "exported/include/initializer_list",
    "exported/include/inttypes.h",
    "exported/include/iomanip",
    "exported/include/ios",
    "exported/include/iosfwd",
    "exported/include/iostream",
    "exported/include/istream",
    "exported/include/iterator",
    "exported/include/limits",
    "exported/include/limits.h",
    "exported/include/list",
    "exported/include/locale",
    "exported/include/locale.h",
    "exported/include/map",
    "exported/include/math.h",
    "exported/include/memory",
    "exported/include/mutex",
    "exported/include/new",
    "exported/include/numeric",
    "exported/include/optional",
    "exported/include/ostream",
    "exported/include/queue",
    "exported/include/random",
    "exported/include/ratio",
    "exported/include/regex",
    "exported/include/scoped_allocator",
    "exported/include/set",
    "exported/include/setjmp.h",
    "exported/include/shared_mutex",
    "exported/include/sstream",
    "exported/include/stack",
    "exported/include/stdbool.h",
    "exported/include/stddef.h",
    "exported/include/stdexcept",
    "exported/include/stdint.h",
    "exported/include/stdio.h",
    "exported/include/stdlib.h",
    "exported/include/streambuf",
    "exported/include/string",
    "exported/include/string.h",
    "exported/include/string_view",
    "exported/include/strstream",
    "exported/include/support/musl/xlocale.h",
    "exported/include/support/newlib/xlocale.h",
    "exported/include/support/xlocale/__nop_locale_mgmt.h",
    "exported/include/support/xlocale/__posix_l_fallback.h",
    "exported/include/support/xlocale/__strtonum_fallback.h",
    "exported/include/support/xlocale/xlocale.h",
    "exported/include/system_error",
    "exported/include/tgmath.h",
    "exported/include/thread",
    "exported/include/tuple",
    "exported/include/type_traits",
    "exported/include/typeindex",
    "exported/include/typeinfo",
    "exported/include/unordered_map",
    "exported/include/unordered_set",
    "exported/include/utility",
    "exported/include/valarray",
    "exported/include/variant",
    "exported/include/vector",
    "exported/include/wchar.h",
    "exported/include/wctype.h",
    "exported/src/algorithm.cpp",
    "exported/src/any.cpp",
    "exported/src/bind.cpp",
    "exported/src/chrono.cpp",
    "exported/src/condition_variable.cpp",
    "exported/src/debug.cpp",
    "exported/src/exception.cpp",
    "exported/src/experimental/filesystem/directory_iterator.cpp",
    "exported/src/experimental/filesystem/operations.cpp",
    "exported/src/experimental/filesystem/path.cpp",
    "exported/src/experimental/memory_resource.cpp",
    "exported/src/functional.cpp",
    "exported/src/future.cpp",
    "exported/src/hash.cpp",
    "exported/src/include/atomic_support.h",
    "exported/src/include/config_elast.h",
    "exported/src/ios.cpp",
    "exported/src/iostream.cpp",
    "exported/src/locale.cpp",
    "exported/src/memory.cpp",
    "exported/src/mutex.cpp",
    "exported/src/new.cpp",
    "exported/src/optional.cpp",
    "exported/src/random.cpp",
    "exported/src/regex.cpp",
    "exported/src/shared_mutex.cpp",
    "exported/src/stdexcept.cpp",
    "exported/src/string.cpp",
    "exported/src/strstream.cpp",
    "exported/src/support/runtime/exception_fallback.ipp",
    "exported/src/support/runtime/exception_glibcxx.ipp",
    "exported/src/support/runtime/exception_libcxxabi.ipp",
    "exported/src/support/runtime/exception_libcxxrt.ipp",
    "exported/src/support/runtime/exception_msvc.ipp",
    "exported/src/support/runtime/exception_pointer_cxxabi.ipp",
    "exported/src/support/runtime/exception_pointer_glibcxx.ipp",
    "exported/src/support/runtime/exception_pointer_msvc.ipp",
    "exported/src/support/runtime/exception_pointer_unimplemented.ipp",
    "exported/src/support/runtime/new_handler_fallback.ipp",
    "exported/src/system_error.cpp",
    "exported/src/thread.cpp",
    "exported/src/typeinfo.cpp",
    "exported/src/utility.cpp",
    "exported/src/valarray.cpp",
    "exported/src/variant.cpp",
    "exported/src/vector.cpp",
  ]

  if (host_os == "win") {
    sources += [
      "exported/include/support/win32/limits_msvc_win32.h",
      "exported/include/support/win32/locale_win32.h",
      "exported/src/support/win32/locale_win32.cpp",
      "exported/src/support/win32/support.cpp",
    ]
  }

  public = [
    "exported/include/algorithm",
    "exported/include/any",
    "exported/include/array",
    "exported/include/atomic",
    "exported/include/bitset",
    "exported/include/cassert",
    "exported/include/ccomplex",
    "exported/include/cctype",
    "exported/include/cerrno",
    "exported/include/cfenv",
    "exported/include/cfloat",
    "exported/include/chrono",
    "exported/include/cinttypes",
    "exported/include/ciso646",
    "exported/include/climits",
    "exported/include/clocale",
    "exported/include/cmath",
    "exported/include/codecvt",
    "exported/include/complex",
    "exported/include/complex.h",
    "exported/include/condition_variable",
    "exported/include/csetjmp",
    "exported/include/csignal",
    "exported/include/cstdarg",
    "exported/include/cstdbool",
    "exported/include/cstddef",
    "exported/include/cstdint",
    "exported/include/cstdio",
    "exported/include/cstdlib",
    "exported/include/cstring",
    "exported/include/ctgmath",
    "exported/include/ctime",
    "exported/include/ctype.h",
    "exported/include/cwchar",
    "exported/include/cwctype",
    "exported/include/deque",
    "exported/include/errno.h",
    "exported/include/exception",
    "exported/include/experimental/algorithm",
    "exported/include/experimental/any",
    "exported/include/experimental/chrono",
    "exported/include/experimental/coroutine",
    "exported/include/experimental/deque",
    "exported/include/experimental/dynarray",
    "exported/include/experimental/filesystem",
    "exported/include/experimental/forward_list",
    "exported/include/experimental/functional",
    "exported/include/experimental/iterator",
    "exported/include/experimental/list",
    "exported/include/experimental/map",
    "exported/include/experimental/memory_resource",
    "exported/include/experimental/numeric",
    "exported/include/experimental/optional",
    "exported/include/experimental/propagate_const",
    "exported/include/experimental/ratio",
    "exported/include/experimental/regex",
    "exported/include/experimental/set",
    "exported/include/experimental/string",
    "exported/include/experimental/string_view",
    "exported/include/experimental/system_error",
    "exported/include/experimental/tuple",
    "exported/include/experimental/type_traits",
    "exported/include/experimental/unordered_map",
    "exported/include/experimental/unordered_set",
    "exported/include/experimental/utility",
    "exported/include/experimental/vector",
    "exported/include/float.h",
    "exported/include/forward_list",
    "exported/include/fstream",
    "exported/include/functional",
    "exported/include/future",
    "exported/include/initializer_list",
    "exported/include/inttypes.h",
    "exported/include/iomanip",
    "exported/include/ios",
    "exported/include/iosfwd",
    "exported/include/iostream",
    "exported/include/istream",
    "exported/include/iterator",
    "exported/include/limits",
    "exported/include/limits.h",
    "exported/include/list",
    "exported/include/locale",
    "exported/include/locale.h",
    "exported/include/map",
    "exported/include/math.h",
    "exported/include/memory",
    "exported/include/mutex",
    "exported/include/new",
    "exported/include/numeric",
    "exported/include/optional",
    "exported/include/ostream",
    "exported/include/queue",
    "exported/include/random",
    "exported/include/ratio",
    "exported/include/regex",
    "exported/include/scoped_allocator",
    "exported/include/set",
    "exported/include/setjmp.h",
    "exported/include/shared_mutex",
    "exported/include/sstream",
    "exported/include/stack",
    "exported/include/stdbool.h",
    "exported/include/stddef.h",
    "exported/include/stdexcept",
    "exported/include/stdint.h",
    "exported/include/stdio.h",
    "exported/include/stdlib.h",
    "exported/include/streambuf",
    "exported/include/string",
    "exported/include/string.h",
    "exported/include/string_view",
    "exported/include/strstream",
    "exported/include/system_error",
    "exported/include/tgmath.h",
    "exported/include/thread",
    "exported/include/tuple",
    "exported/include/type_traits",
    "exported/include/typeindex",
    "exported/include/typeinfo",
    "exported/include/unordered_map",
    "exported/include/unordered_set",
    "exported/include/utility",
    "exported/include/valarray",
    "exported/include/variant",
    "exported/include/vector",
    "exported/include/wchar.h",
    "exported/include/wctype.h",
  ]

  libs = [ "m" ]
  if (host_os == "linux") {
    libs += [ "rt" ]
  }

  configs = []
  configs += [ 
    ":flags",
    "//build/config:default_library",
  ]
  if (host_os == "win") {
    configs += [ "//build/config:no_exceptions" ]
  } else if (host_os == "mac") {
    configs += ["//build/config/mac:compatibility"]
  }
  public_configs = [ ":includes" ]

  deps = []
  deps += [ "//src/third_party/libcxxabi:c++abi" ]
}
